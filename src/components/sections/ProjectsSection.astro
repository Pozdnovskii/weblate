---
import type { ImageMetadata } from "astro";
import Section from "@components/UI/Section.astro";
import projects from "@data/projects.json";
import { Image } from "astro:assets";

const images = import.meta.glob<{ default: ImageMetadata }>(
  "/src/assets/images/projects/*.{png,jpg,webp}",
  { eager: true },
);

function getImage(filename) {
  if (!filename) return null;
  const path = `/src/assets/images/projects/${filename}`;
  return images[path]?.default || null;
}
---

<Section id="projects" title="Projects" class="wrapper">
  <ul>
    {
      projects.map((project, index) => (
        <li>
          <button
            type="button"
            data-hover-direction
            aria-expanded="false"
            aria-controls={`project-${index}`}
            data-umami-event="project-open"
            data-umami-event-project={project.title}
          >
            <h3>{project.title}</h3>
            <div aria-hidden="true">{String(index + 1).padStart(2, "0")}</div>
            <div aria-hidden="true" />
          </button>

          <div id={`project-${index}`} hidden>
            <div data-project-img>
              {getImage(project.desktopImage) && (
                <Image
                  src={getImage(project.desktopImage)}
                  alt={`${project.title} desktop screenshot`}
                />
              )}
              {getImage(project.mobileImage) && (
                <Image
                  src={getImage(project.mobileImage)}
                  alt={`${project.title} mobile screenshot`}
                />
              )}
            </div>

            <div data-project-info>
              <p>{project.description || "Project description coming soon."}</p>

              <div>
                <div>
                  <h4>Services</h4>
                  <ul>
                    {project.services?.map((service) => (
                      <li>{service}</li>
                    ))}
                  </ul>
                </div>
                <div>
                  <h4>Technologies</h4>
                  <ul>
                    {project.tools?.map((tool) => (
                      <li>{tool}</li>
                    ))}
                  </ul>
                </div>
              </div>
              {project.link ? (
                <a
                  href={project.link}
                  target="_blank"
                  rel="noopener"
                  data-umami-event="project-visit"
                  data-umami-event-project={project.title}
                >
                  Visit Website
                </a>
              ) : (
                <span>Link temporarily unavailable</span>
              )}
            </div>
          </div>
        </li>
      ))
    }
  </ul>
</Section>
